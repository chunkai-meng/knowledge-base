# Python è¯»ä¹¦ç¬”è®°

>   11 Sep 2019

[TOC]

## ã€ŠPython Tricks A Buffet of Awesome Python Featuresã€‹



### 2 Patterns of Cleaner Python

#### 2.1 Assertion

* ç”¨æ¥ç»™ç¨‹åºè‡ªå·±æ£€æŸ¥è‡ªå·±çš„é”™è¯¯ï¼ˆæ¯”å¦‚ä¸€äº›ä¸è¯¥å‘ç”Ÿçš„äº‹ï¼Œæ¯”å¦‚è®¡ç®—å‡ºæŸä¸ªäººçš„å¹´é¾„æ˜¯è´Ÿæ•°ï¼Œä¹‹ç±»ï¼‰ï¼Œ

* å¯ä»¥å¸®åŠ©å‘ç°Bugï¼Œè¿˜å¯ä»¥ç»™å‡ºé”™è¯¯ä¿¡æ¯ï¼Œ

* éè¿è¡Œæ—¶é”™è¯¯ï¼Œä¸å¯ç”¨äºéªŒè¯ç”¨æˆ·è¾“å…¥

* åœ¨ç¼–è¯‘å™¨è®¾å®šé‡Œå¯ä»¥è®¾å®šå¿½ç•¥æ‰€æœ‰ Assertion æ£€æŸ¥

    ```python
    if cond == 'x': 
        do_x()
    elif cond == 'y':
        do_y()
    else:
        assert False, ('This should never happen, but it does '
                       'occasionally. We are     currently trying to '
                       'figure out why. Email dbader if you '
                       'encounter this in the wild. Thanks!')
    ```



#### 2.3 Context Managers and the with Statement

##### `with` è¯­å¥

*   with è¯­å¥æŠŠå¯¹ç³»ç»Ÿèµ„æºçš„é‡Šæ”¾æŠ½ç¦»å‡ºæ¥

*   with ä»£ç å—æ‰§è¡Œå®Œåè‡ªåŠ¨é‡Šæ”¾èµ„æº

```python
with ManagedFile('hello.txt') as f:    # ç›¸å½“äº foo = ManagedFile('hello.txt');  f = foo.__enter__()
    f.write('hello, world!')
    f.write('bye now')
    # 									<------- åŠ å¡ï¼š foo.__exit__()
```

ç­‰åŒäºï¼š

```python
f = open('hello.txt', 'w') try:
f.write('hello, world') finally:
f.close()
```

**æ”¯æŒ `with` è¯­å¥çš„æ–¹æ³•**

##### class-based context manager

*   `context manager` æ˜¯ä¸€ä¸ªåè®®æˆ–è€…æ¥å£

*   å®ç°äº† `__enter__` and `__exit__` æ–¹æ³•çš„å¯¹è±¡å°±æ˜¯ context manager

*   Pythonä¼šåœ¨åˆé€‚çš„æ—¶å€™è°ƒç”¨è¿™äº›æ–¹æ³•ï¼Œæˆ‘çš„ç†è§£å°±æ˜¯Pythonä¼šåœ¨ä½ çš„ with ä»£ç å—çš„å¼€å¤´å’Œç»“å°¾åŠ å¡

    ```python
    class ManagedFile:
    	def __init__(self, name):
    		self.name = name
    
    	def __enter__(self):
    		self.file = open(self.name, 'w') return self.file
    
    	def __exit__(self, exc_type, exc_val, exc_tb):
    		if self.file:
    			self.file.close()
    ```

##### generator-based å·¥å‚å‡½æ•°

```python
from contextlib import contextmanager

@contextmanager 
def managed_file(name):
    try:
        f = open(name, 'w') 
        yield f 
    finally:
        f.close()

with managed_file('hello.txt') as f:
    f.write('hello, world!')
    f.write('bye now')
```

*managed_file* ç”Ÿæˆå™¨åªæœ‰ä¸€ä¸ª yield ä¹Ÿå°±æ˜¯åªèƒ½è¿”å›ä¸€éå€¼ï¼Œç¬¬äºŒéå°±èµ°å®Œç¨‹åºå—`f.close()`é€€å‡ºäº†

ç›®æµ‹ @contextmanager æ˜¯å°†å¯¹ *managed_file*  çš„ç¬¬ä¸€æ¬¡è°ƒç”¨ä½œä¸º `__enter__` ç¬¬äºŒæ¬¡è°ƒç”¨ä½œä¸º `__exit__` 



#### 2.4 Underscores, Dunders, and More

1.  `_var` 

    ä»…ä»…æ˜¯ Python ä¹ æƒ¯ï¼Œæç¤ºè¯»è€…è¿™ä¸ªå˜é‡æ˜¯å†…éƒ¨å˜é‡ï¼Œäº‹å®ä¸Š Python ä¸åƒ Java é‚£æ ·åŒºåˆ†å†…å¤–éƒ¨å˜é‡

    æ³¨ `_var` å†™åœ¨æ–‡ä»¶é‡Œè€Œä¸æ˜¯åœ¨å¯¹è±¡é‡Œï¼Œ`from my_model import *` ä¼šåŒ¹é…ä¸åˆ°

2.  `var_`

    ä¹Ÿæ˜¯ä¸ªä¹ æƒ¯ï¼Œç”¨æ¥è§£å†³å‘½åå†²çªï¼ŒåŠ ä¸ªä¸‹åˆ’çº¿åœ¨åé¢å°±æ˜¯å¦ä¸€ä¸ªå˜é‡å•¦ï¼Œå°±è¿™ä¹ˆéšæ„ï½

3.  `__var` 

    Python ç¼–è¯‘å™¨ä¼šç»™å®ƒæ”¹åæˆ `_<class Name>__var` è¿™æ ·å¯ä»¥é˜²æ­¢ç»§æ‰¿çš„æ—¶å€™å˜é‡è¢«è¦†ç›–ï¼Œè¿™æ ·å„ä¸ªç±»éƒ½æœ‰è‡ªå·±çš„å˜é‡ï¼Œ`__var` å°±ä¸å­˜åœ¨äº†ã€‚å¯¹æ–¹æ³•ååŒæ ·æœ‰æ•ˆã€‚
    æˆ‘æ€€ç–‘åœ¨ç¼–è¯‘æ—¶å°±è¢«æ”¹äº†

4.  dunder = double underscores 
    __<name>__ æ˜¯ python ä¿ç•™çš„å˜é‡å’Œæ–¹æ³•ï¼Œè‡ªå·±å®šä¹‰ä¸è¦ç”¨è¿™æ ·çš„æ–¹å¼å®šä¹‰
    
5. _ æ— ç”¨çš„å˜é‡ï¼Œè§£åŒ…çš„æ—¶å€™ç”¨æ¥å ä½ã€‚åœ¨äº¤äº’æ¨¡å¼python ä¹Ÿå¯ä»¥ç”¨æ¥è·å–ä¸Šä¸€ä¸ªå˜é‡



## 2.5 About String Formatting

1. Old Style `%` æ“ä½œç¬¦

   ```python
   errno = 50159747054
   name = 'Bob'
   'Hello, %s' % name
   ```

   % æ“ä½œç¬¦åªèƒ½æ¥æ”¶1ä¸ªå‚æ•°ï¼Œå¦‚æœå¤šä¸ªéœ€è¦ç”¨å…ƒç¥–

   ```python
   >>> 'Hey %s, there is a 0x%x error!' % (name, errno)
   'Hey Bob, there is a 0xbadc0ffee error!'
   ```

   æˆ–å­—å…¸

   ```python
   >>> 'Hey %(name)s, there is a 0x%(errno)x error!' % {
   ... "name": name, "errno": errno }
   'Hey Bob, there is a 0xbadc0ffee error!'
   ```

   

2. æ–° style 

   å¯¹åº”ä½ç½®æ ¼å¼åŒ– - è·Ÿold styleç±»ä¼¼

   ```python
   >>> 'Hello, {}'.format(name)
   'Hello, Bob'
   ```

   ç»™å®šå‚æ•°æ ¼å¼åŒ– - è¿™ç§æ–¹å¼å·²ç»å¾ˆæ¥è¿‘æ¨¡æ¿äº†ï¼Œç»™å®šå˜é‡ï¼Œæ¨¡æ¿å¯ä»¥åœ¨ä¸è¶…å‡ºç»™å®šå˜é‡çš„èŒƒå›´å†…è‡ªç”±å®šä¹‰

   ```python
   'Hey {name}, there is a 0x{errno:x} error!'.format(
   ... name=name, errno=errno)
   'Hey Bob, there is a 0xbadc0ffee error!'
   ```

   å¥½å¤„æ˜¯å˜é‡çš„é¡ºåºè·Ÿå­—ç¬¦ä¸²é‡Œå‡ºç°çš„é¡ºåºæ— å…³äº†ï¼Œè€Œä¸”åŒä¸€ä¸ªå˜é‡å¯ä»¥é‡å¤å‡ºç°å¤šæ¬¡

   è¦æ ¼å¼åŒ–æ•°å­—å¯ä»¥ç”¨ â€œ:xâ€ suffix 

   

3. literal String Interpolation - _f-strings_  (_Python 3.6+_) 

   æˆ‘è¯•è¿‡ python3.5 ä¼šæŠ¥é”™

   ```python
   >>> f'Hello, {name}!'		# æ¸…æ–°è„±ä¿—å•Šï¼Œnameæ˜¯ä¸Šä¸‹æ–‡ä¸­å®šä¹‰è¿‡çš„å˜é‡ï¼Œè¿æ ¼å¼åŒ–çš„å‚æ•°éƒ½çœäº†
   'Hello, Bob!'
   ```

   è¿˜æ”¯æŒè¡Œå†…è®¡ç®—ï¼ŒçœŸæ˜¯æ— æ•Œäº†

   ```python
   >>> a = 5
   >>> b = 10
   >>> f'Five plus ten is {a + b} and not {2 * (a + b)}.'
   'Five plus ten is 15 and not 30.'
   Behind
   ```

   åŒæ ·æ”¯æŒæ•°å­—è¿›åˆ¶è½¬æ¢ï¼Œè™½ç„¶ä»æ¥æ²¡ç”¨è¿‡

   ```python
   >>> f"Hey {name}, there's a {errno:#x} error!"
   "Hey Bob, there's a 0xbadc0ffee error!"
   ```

   

4. Template Strings

   æ­£å¸¸ç”¨æ³•

   ```python
   >>> templ_string = 'Hey $name, there is a $error error!'
   >>> Template(templ_string).substitute(
   ... name=name, error=hex(errno))
   'Hey Bob, there is a 0xbadc0ffee error!'
   ```

   çœ‹èµ·æ¥ä¸å¦‚ `f-strings` ç®€æ´ï¼Œä½†å¦‚æœå­—ç¬¦ä¸²å¼€æ–¹ç»™ç”¨æˆ·è¾“å…¥çš„è¯ï¼Œ _f-strings_ çš„è¯å®¹æ˜“æˆä¸ºåé—¨ï¼Œæ³„éœ²ç¨‹åºå†…éƒ¨å…¶ä»–æ•°æ®

   ```python
   >>> SECRET = 'this-is-a-secret'
   >>> class Error:
   ... def __init__(self):
   ... pass
   >>> err = Error()
   >>> user_input = '{error.__init__.__globals__[SECRET]}'
   # Uh-oh...
   >>> user_input.format(error=err)
   'this-is-a-secret'
   ```

   

5. é‚£ä¹ˆï¼Œè¯¥ç”¨å“ªä¸ªï¼Ÿ

   python 3.6+ çš„æ¯«ä¸çŠ¹è±«ç”¨ _f-string_

   String æ˜¯ç”¨æˆ·è‡ªç”±è¾“å…¥çš„å°±ç”¨ *Template Strings*



**The Zen of Python, by Tim Peters**

ç»å…¸çš„ Python ä¹‹ç¦…ï¼Œç¿»è¯‘ä¸€ä¸‹å§ï¼Œæƒå½“è†œæ‹œ
çœ‹èµ·æ¥èˆ’æœèƒœäºçœ‹èµ·æ¥å¾ˆä¸‘
ç›´ç™½èƒœäºæ¯”æš—ç¤º
ç®€å•èƒœäºæ‚å¤š
æ‚å¤šèƒœäºç¹æ‚ï¼ˆComplex is better than complicatedï¼Œ Complex å¼ºè°ƒå¤šï¼ŒComplicated å¼ºè°ƒéš¾ç†è§£éš¾å¤„ç†å•Šï¼‰
æ‰å¹³èƒœäºåµŒå¥—
é—´éš”èƒœäºç´§å‡‘
å¯è¯»æ€§å¾ˆé‡è¦ï¼Œ ç‰¹ä¾‹ä¹Ÿä¸è¶³ä»¥æ¨ç¿»è¿™æ¡ï¼ˆè¿™äº›è§„åˆ™è‡³é«˜æ— ä¸Šï¼‰
é”™è¯¯ä¸èƒ½æ‚„æ— å£°æ¯çš„æ”¾è¿‡ï¼Œé™¤éä½ ç¡®å®šéœ€è¦è¿™æ ·åšï¼ˆç²¾å‡†åœ°æ•è·å¼‚å¸¸ï¼Œä¸å†™ except:pass é£æ ¼çš„ä»£ç ï¼‰

> Pythonä¹‹ç¦… by Tim Peters
 ä¼˜ç¾èƒœäºä¸‘é™‹ï¼ˆPython ä»¥ç¼–å†™ä¼˜ç¾çš„ä»£ç ä¸ºç›®æ ‡ï¼‰
æ˜äº†èƒœäºæ™¦æ¶©ï¼ˆä¼˜ç¾çš„ä»£ç åº”å½“æ˜¯æ˜äº†çš„ï¼Œå‘½åè§„èŒƒï¼Œé£æ ¼ç›¸ä¼¼ï¼‰
ç®€æ´èƒœäºå¤æ‚ï¼ˆä¼˜ç¾çš„ä»£ç åº”å½“æ˜¯ç®€æ´çš„ï¼Œä¸è¦æœ‰å¤æ‚çš„å†…éƒ¨å®ç°ï¼‰
å¤æ‚èƒœäºå‡Œä¹±ï¼ˆå¦‚æœå¤æ‚ä¸å¯é¿å…ï¼Œé‚£ä»£ç é—´ä¹Ÿä¸èƒ½æœ‰éš¾æ‡‚çš„å…³ç³»ï¼Œè¦ä¿æŒæ¥å£ç®€æ´ï¼‰
æ‰å¹³èƒœäºåµŒå¥—ï¼ˆä¼˜ç¾çš„ä»£ç åº”å½“æ˜¯æ‰å¹³çš„ï¼Œä¸èƒ½æœ‰å¤ªå¤šçš„åµŒå¥—ï¼‰
é—´éš”èƒœäºç´§å‡‘ï¼ˆä¼˜ç¾çš„ä»£ç æœ‰é€‚å½“çš„é—´éš”ï¼Œä¸è¦å¥¢æœ›ä¸€è¡Œä»£ç è§£å†³é—®é¢˜ï¼‰
å¯è¯»æ€§å¾ˆé‡è¦ï¼ˆä¼˜ç¾çš„ä»£ç æ˜¯å¯è¯»çš„ï¼‰
å³ä¾¿å‡å€Ÿç‰¹ä¾‹çš„å®ç”¨æ€§ä¹‹åï¼Œä¹Ÿä¸å¯è¿èƒŒè¿™äº›è§„åˆ™ï¼ˆè¿™äº›è§„åˆ™è‡³é«˜æ— ä¸Šï¼‰
ä¸è¦åŒ…å®¹æ‰€æœ‰é”™è¯¯ï¼Œé™¤éä½ ç¡®å®šéœ€è¦è¿™æ ·åšï¼ˆç²¾å‡†åœ°æ•è·å¼‚å¸¸ï¼Œä¸å†™ except:pass é£æ ¼çš„ä»£ç ï¼‰
å½“å­˜åœ¨å¤šç§å¯èƒ½ï¼Œä¸è¦å°è¯•å»çŒœæµ‹
è€Œæ˜¯å°½é‡æ‰¾ä¸€ç§ï¼Œæœ€å¥½æ˜¯å”¯ä¸€ä¸€ç§æ˜æ˜¾çš„è§£å†³æ–¹æ¡ˆï¼ˆå¦‚æœä¸ç¡®å®šï¼Œå°±ç”¨ç©·ä¸¾æ³•ï¼‰
è™½ç„¶è¿™å¹¶ä¸å®¹æ˜“ï¼Œå› ä¸ºä½ ä¸æ˜¯ Python ä¹‹çˆ¶ï¼ˆè¿™é‡Œçš„ Dutch æ˜¯æŒ‡ Guido ï¼‰
åšä¹Ÿè®¸å¥½è¿‡ä¸åšï¼Œä½†ä¸å‡æ€ç´¢å°±åŠ¨æ‰‹è¿˜ä¸å¦‚ä¸åšï¼ˆåŠ¨æ‰‹ä¹‹å‰è¦ç»†æ€é‡ï¼‰
å¦‚æœä½ æ— æ³•å‘äººæè¿°ä½ çš„æ–¹æ¡ˆï¼Œé‚£è‚¯å®šä¸æ˜¯ä¸€ä¸ªå¥½æ–¹æ¡ˆï¼›åä¹‹äº¦ç„¶ï¼ˆæ–¹æ¡ˆæµ‹è¯„æ ‡å‡†ï¼‰
å‘½åç©ºé—´æ˜¯ä¸€ç§ç»å¦™çš„ç†å¿µï¼Œæˆ‘ä»¬åº”å½“å¤šåŠ åˆ©ç”¨ï¼ˆå€¡å¯¼ä¸å·å¬ï¼‰

[Reference](https://blog.csdn.net/gzlaiyonghao/article/details/2151918)

## Pythonâ€™s Functions Are First-Class

Python é‡Œä¸€åˆ‡æ•°æ®éƒ½æ˜¯å¯¹è±¡æˆ–è€…å¯¹è±¡ä¹‹é—´çš„å…³ç³»
å‡½æ•°çš„å¯¹è±¡å’Œå‡½æ•°çš„åå­—æ˜¯ä¸¤ä¸ªæ¦‚å¿µ

```python
def yell(text):
    return text.upper() + '!'

>>> bark.__name__
'yell'
```

åˆ é™¤ä¸€ä¸ªå¯¹è±¡

```python
>> del yell
```

**é‡ç‚¹ï¼šæ—¢ç„¶æ˜¯å¯¹è±¡å°±å¯ä»¥ä¿å­˜åœ¨æ•°æ®ç»“æ„ä¸­**

``` python
>>> funcs = [bark, str.lower, str.capitalize]
>>> funcs [<function yell at 0x10ff96510>,
<method 'lower' of 'str' objects>,
<method 'capitalize' of 'str' objects>]

# å¯ä»¥åœ¨å¾ªç¯ä¸­å–ç”¨
>>> for f in funcs:
...     print(f, f('hey there')) 
<function yell at 0x10ff96510> 'HEY THERE!'
<method 'lower' of 'str' objects> 'hey there'
<method 'capitalize' of 'str' objects> 'Hey there'

# ä¹Ÿå¯ä»¥ç›´æ¥æŒ‰ä½ç½®å¼•ç”¨æ‰§è¡Œ
>>> funcs[0]('heyho'ï¼‰
```

**è¿˜å¯ä»¥ä¼ é€’ç»™å…¶ä»–å‡½æ•°**

```python
def greet(func):
    greeting = func('Hi, I am a Python program')
    print(greeting)
    
>>> greet(bark)
'HI, I AM A PYTHON PROGRAM!'
```

å¯ä»¥å®šä¹‰å…¶ä»–å‡½æ•°ä¼ ç»™ greetï¼Œè¿™æ ·å‡½æ•°æ‰§è¡Œçš„åŠ¨ä½œæœ‰å¯ä»¥æœ‰æ›´å¤§çš„è‡ªç”±ï¼Œ
å¯ä»¥æ¥å—å‡½æ•°ä½œä¸ºå‚æ•°çš„å‡½æ•°è¢«ç§°ä¸ºé«˜é˜¶å‡½æ•°ï¼Œè¿™æ˜¯å‡½æ•°è¯•ç¼–ç¨‹æ‰€å¿…é¡»çš„

ç»å…¸çš„é«˜é˜¶å‡½æ•°æ˜¯ mapï¼Œä»¥ä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ä½œä¸ºå‚æ•°
æ¯æ¬¡ä»å¯è¿­ä»£å¯¹è±¡ä¸­å–ä¸€ä¸ªå…ƒç´ å‡ºæ¥ä¼ é€’ç»™å‡½æ•°æ‰§è¡Œï¼Œå¹¶è¿”å›æ‰§è¡Œç»“æœ

**å‡½æ•°å¯ä»¥è¢«åµŒå¥—**

```python
def speak(text):
	def whisper(t):
		return t.lower() + '...' 
	return whisper(text)

>>> speak('Hello, World')
'hello, world...'
```
æˆ‘ç†è§£ä»¥ä¸Šæ–¹æ³•è·Ÿä¼ é€’ä¸€ä¸ªå‡½æ•°è¿›å»åŠŸèƒ½æ˜¯ç±»ä¼¼çš„ï¼ŒåŒºåˆ«å°±æ˜¯ç°åœ¨è¿™æ ·æ¯æ¬¡éƒ½æœ‰å†…å­˜å¼€é”€å’Œé‡Šæ”¾ï¼Œä¸ºäº†å»ºç«‹è¿™ä¸ªå†…éƒ¨å‡½æ•°

```python
>>> whisper('Yo') 
NameError:
"name 'whisper' is not defined"

>>> speak.whisper 
AttributeError:
"'function' object has no attribute 'whisper'"
```

è¿™é‡Œä¹Ÿæ²¡æœ‰æ‰¾åˆ°whisper æ˜¯å› ä¸ºè¿™ä¸ªå†…éƒ¨å‡½æ•°æ˜¯æ¯æ¬¡è°ƒç”¨çš„æ—¶å€™æ‰åˆ›å»ºçš„ï¼Œæ‰€ä»¥æ ¹æ®å‡½æ•°åå¼•ç”¨å¼•ç”¨ä¸åˆ°ã€‚å¦‚æœè¿™æ ·å°±å¯ä»¥äº†ï¼š

```python
def get_speak_func(volume):
	def whisper(text):
		return text.lower() + '...'
	def yell(text):
		return text.upper() + '!'
	if volume > 0.5:
		return yell
	else:
		return whisper
		
>>> get_speak_func(0.3)
<function get_speak_func.<locals>.whisper at 0x10ae18>

>>> get_speak_func(0.7)
<function get_speak_func.<locals>.yell at 0x1008c8>

>>> speak_func = get_speak_func(0.7)
>>> speak_func('Hello') 
'HELLO!'
```

å› ä¸º get_speak_func æ‰§è¡Œäº†ï¼Œæ‰€ä»¥å†…å‡½æ•°åˆ›å»ºäº†ï¼Œå¹¶è¿”å›å‡ºæ¥ã€‚ç”±äºä»˜å€¼ç»™ speak_func, ç»§ç»­æœ‰å˜é‡åœ¨å¼•ç”¨è¯¥å¯¹è±¡æ‰€ä»¥æ²¡æœ‰é‡Šæ”¾å†…å­˜ã€‚



**å‡½æ•°å¯ä»¥è·å–å±€éƒ¨å˜é‡ï¼ˆLocal Stateï¼‰**

```python
def get_speak_func(text, volume):
	def whisper():
		return text.lower() + '...'
	def yell():
		return text.upper() + '!'
	if volume > 0.5:
		return yell
	else:
		return whisper
    
>>> get_speak_func('Hello, World', 0.7)()	# å‡½æ•°çš„è¿”å›å€¼å¯ä»¥è¢«ç«‹å³è°ƒç”¨
'HELLO, WORLD!'
```

> ğŸ’¡**æ‰§è¡Œ `get_speak_func('Hello, World', 0.7)` å¾—åˆ°çš„æ˜¯ä¸€ä¸ªå‡½æ•° *yell*, è¿™ä¸ªå‡½æ•°å·²ç»ç¦»å¼€äº† get_speak_func å‡½æ•°ä½“ï¼Œè€Œ *text* å˜é‡æ˜¯åœ¨è¿™ä¸ªå‡½æ•°ä½“å†…çš„ï¼Œç¦»å¼€äº†å®ƒ *text* å°±ä¸å­˜åœ¨äº†ï¼Œä½†è¿™ä¸ªè¿”å›å‡ºæ¥çš„å‡½æ•°ä¾ç„¶ä¿ç•™äº†å½“æ—¶çš„ text å˜é‡ã€‚** è¿™æ ·çš„å‡½æ•°ç§°ä¹‹ä¸º**é—­åŒ…**

**ä¸€ä¸ªé—­åŒ…è®°å¾—å°è£…å®ƒçš„æ—¶å€™çš„ä½œç”¨åŸŸå†…çš„å˜é‡**

è¿™æ„å‘³ç€æˆ‘ä»¬ä¸å…‰å¯ä»¥ç”¨å‡½æ•°è¿”å›ä¸€ä¸ªè¡Œä¸ºï¼Œè€Œä¸”å¯ä»¥é¢„å®šä¹‰è¿™ä¸ªè¡Œä¸ºã€‚ä¾‹å¦‚ï¼š

```python
def make_adder(n):
	def add(x):
		return x + n
return add

>>> plus_3 = make_adder(3)
```

`make_adder` æ˜¯å·¥ç¨‹ç”Ÿäº§å¹¶é¢„åˆ¶äº† â€œaddrâ€œ å‡½æ•°



**æ‰§è¡Œä¸€ä¸ªå¯¹è±¡**

```python
class Adder:
	def __init__(self, n):
		self.n = n

	def __call__(self, x):
		return self.n + x

>>> plus_3 = Adder(3)
>>> plus_3(4) 
7
```

è°ƒç”¨ä¸€ä¸ªå¯¹è±¡å°±æ˜¯æ‰§è¡Œå®ƒçš„ `__call__` æ–¹æ³•